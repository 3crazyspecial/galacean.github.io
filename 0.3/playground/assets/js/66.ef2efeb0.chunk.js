(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{495:function(e,r,n){"use strict";n.r(r),r.default='import { OrbitControl } from "@oasis-engine/controls";\r\nimport { FramebufferPicker } from "@oasis-engine/framebuffer-picker";\r\nimport {\r\n  AssetType,\r\n  Camera,\r\n  Color,\r\n  EnvironmentMapLight,\r\n  GLTFResource,\r\n  LoadItem,\r\n  Logger,\r\n  SystemInfo,\r\n  TextureCubeMap,\r\n  Vector3,\r\n  WebGLEngine\r\n} from "oasis-engine";\r\n\r\nLogger.enable();\r\n\r\nconst engine = new WebGLEngine("o3-demo");\r\nengine.canvas.width = window.innerWidth * SystemInfo.devicePixelRatio;\r\nengine.canvas.height = window.innerHeight * SystemInfo.devicePixelRatio;\r\nconst scene = engine.sceneManager.activeScene;\r\nconst rootNode = scene.createRootEntity();\r\n//-- create engine object\r\n\r\nlet envLightNode = rootNode.createChild("env_light");\r\nlet envLight = envLightNode.addComponent(EnvironmentMapLight);\r\n\r\n//-- create camera\r\nlet cameraNode = rootNode.createChild("camera_node");\r\ncameraNode.transform.position = new Vector3(0, 0, 30);\r\nconst camera = cameraNode.addComponent(Camera);\r\ncameraNode.addComponent(OrbitControl);\r\n\r\nconst resources: LoadItem[] = [\r\n  { url: "https://gw.alipayobjects.com/os/bmw-prod/83219f61-7d20-4704-890a-60eb92aa6159.gltf" },\r\n  {\r\n    urls: [\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*Bk5FQKGOir4AAAAAAAAAAAAAARQnAQ",\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*_cPhR7JMDjkAAAAAAAAAAAAAARQnAQ",\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*trqjQp1nOMQAAAAAAAAAAAAAARQnAQ",\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*_RXwRqwMK3EAAAAAAAAAAAAAARQnAQ",\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*q4Q6TroyuXcAAAAAAAAAAAAAARQnAQ",\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*DP5QTbTSAYgAAAAAAAAAAAAAARQnAQ"\r\n    ],\r\n    type: AssetType.TextureCube\r\n  },\r\n  {\r\n    urls: [\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*5w6_Rr6ML6IAAAAAAAAAAAAAARQnAQ",\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*TiT2TbN5cG4AAAAAAAAAAAAAARQnAQ",\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*8GF6Q4LZefUAAAAAAAAAAAAAARQnAQ",\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*D5pdRqUHC3IAAAAAAAAAAAAAARQnAQ",\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*_FooTIp6pNIAAAAAAAAAAAAAARQnAQ",\r\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*CYGZR7ogZfoAAAAAAAAAAAAAARQnAQ"\r\n    ],\r\n    type: AssetType.TextureCube\r\n  }\r\n];\r\n\r\nengine.resourceManager.load(resources).then((res) => {\r\n  const gltf = <GLTFResource>res[0];\r\n\r\n  let mesh = gltf.meshes[0];\r\n  for (let x = 0; x < 5; x++) {\r\n    for (let y = 0; y < 5; y++) {\r\n      let testNode = rootNode.createChild("test_mesh" + x + y);\r\n      testNode.addChild(gltf.defaultSceneRoot.clone());\r\n      testNode.transform.position = new Vector3((x - 2) * 5, (y - 2) * 5, 0);\r\n    }\r\n  }\r\n\r\n  envLight.diffuseTexture = <TextureCubeMap>res[1];\r\n  envLight.specularTexture = <TextureCubeMap>res[2];\r\n\r\n  // framebuffer picker\r\n  let lastMaterial;\r\n  let laseBaseColor;\r\n  let framebufferPicker = rootNode.addComponent(FramebufferPicker);\r\n  framebufferPicker.camera = camera;\r\n  framebufferPicker.onPick = (obj) => {\r\n    if (lastMaterial) lastMaterial.baseColor = laseBaseColor;\r\n\r\n    if (obj) {\r\n      const { primitive, component } = obj;\r\n      let material = component.getInstanceMaterial();\r\n\r\n      lastMaterial = material;\r\n      laseBaseColor = material.baseColor;\r\n      material.baseColor = new Color(1, 0, 0, 1);\r\n    }\r\n  };\r\n\r\n  document.getElementById("o3-demo").addEventListener("mousedown", (e) => {\r\n    // console.log(e.offsetX, e.offsetY);\r\n    framebufferPicker.pick(e.offsetX, e.offsetY);\r\n  });\r\n});\r\n\r\n//-- run\r\nengine.run();\r\n'}}]);